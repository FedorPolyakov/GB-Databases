SHOW TABLES;
CREATE DATABASE HW5;
USE HW5;

/*
 ???????????? ??????? ?? ???? “?????????, ??????????, ?????????? ? ???????????”

 ?????? ? ?????? ??????? ?????? ??????? users ????????? ??????? example1

 1)????? ? ??????? users ???? created_at ? updated_at ????????? ??????????????. ????????? ?? ???????? ????? ? ????????.
 */
CREATE TABLE example1 (
id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
name VARCHAR(40) NOT NULL,
created_at DATETIME DEFAULT NULL,
updated_at DATETIME DEFAULT NULL
);
INSERT INTO example1 VALUES (1, 'Nick', NOW(), NULL);
INSERT INTO example1 VALUES (NULL, 'Maria', NOW(), NULL);
INSERT INTO example1 VALUES (NULL,'Max',NULL, NULL);
INSERT INTO example1 VALUES (NULL,'Gregory',NULL, NOW());

UPDATE example1 SET created_at = NOW(), updated_at = NOW();

/*
2)??????? users ???? ???????? ??????????????.
?????? created_at ? updated_at ???? ?????? ????? VARCHAR
? ? ??? ?????? ????? ?????????? ???????? ? ??????? "20.10.2017 8:10".
?????????? ????????????? ???? ? ???? DATETIME, ???????? ???????? ????? ????????.

????? ? ???????? ??? ?? ??????? ??????? change_date. ??? ??????? ??????????? ?? ?? ???????? ??? ? ? change_date
 */
ALTER TABLE example1 ADD change_date VARCHAR(40) NULL;
UPDATE example1 SET change_date = "20.10.2017 8:10";
UPDATE example1 SET change_date = date_format(str_to_date(change_date, '%d.%m.%Y %H:%i'), '%Y-%m-%d %H:%i');


/*
create table VarcharToDate
   (
   Id int NOT NULL AUTO_INCREMENT,
   Created_Time varchar(100),
   PRIMARY KEY(Id)
   );
   
  insert into VarcharToDate(Created_Time) values('12/1/2016 8:10');
  insert into VarcharToDate(Created_Time) values('14/3/2017 9:22');
  insert into VarcharToDate(Created_Time) values('15/3/2018 10:01');
  insert into VarcharToDate(Created_Time) values('19/8/2019 13:11');
  insert into VarcharToDate(Created_Time) values('21/11/2020 22:21');
 SELECT * FROM VarcharToDate;
 select date_format(str_to_date(Created_Time, '%d/%m/%Y %H:%i'), '%Y-%m-%d %H:%i') as Date from VarcharToDate;
 
DESC VarcharToDate;
TRUNCATE  VarcharToDate;
DROP TABLE VarcharToDate;
*/
/*
? ??????? ????????? ??????? storehouses_products ? ???? value ????? ??????????? ????? ?????? ?????:
0, ???? ????? ?????????? ? ???? ????, ???? ?? ?????? ??????? ??????.
?????????? ????????????? ?????? ????? ???????, ????? ??? ?????????? ? ??????? ?????????? ???????? value.
??????, ??????? ?????? ?????? ?????????? ? ?????, ????? ???? ???????.
 */
CREATE TABLE storehouses_products (
id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
value INT UNSIGNED NOT NULL
);
TRUNCATE storehouses_products; 
INSERT INTO storehouses_products(value) VALUES(0);
INSERT INTO storehouses_products(value) VALUES(1);
INSERT INTO storehouses_products(value) VALUES(11);
INSERT INTO storehouses_products(value) VALUES(2020);
INSERT INTO storehouses_products(value) VALUES(20);
INSERT INTO storehouses_products(value) VALUES(32);
INSERT INTO storehouses_products(value) VALUES(0);
INSERT INTO storehouses_products(value) VALUES(0);
INSERT INTO storehouses_products(value) VALUES(0);
INSERT INTO storehouses_products(value) VALUES(2);
SELECT * FROM storehouses_products ;

SELECT id, value FROM (
SELECT *,
CASE
		WHEN value = 0 THEN 'zero'
		ELSE 'NOT zero'
END AS st
FROM storehouses_products ORDER BY st,value) AS A;


/*SELECT id, value FROM (SELECT * FROM storehouses_products) as A;*/

DROP TABLE users;
CREATE TABLE users (
id INT UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT,
name VARCHAR(30) NOT NULL,
last_name VARCHAR(50) NOT NULL,
birthday date
);
TRUNCATE users; 
INSERT INTO users(name,last_name,birthday) VALUES ('Max','Rodriges','1992-01-01');
INSERT INTO users(name,last_name,birthday) VALUES ('Leo','Orlando','1992-05-12');
INSERT INTO users(name,last_name,birthday) VALUES ('Kate','Kempbell','1995-09-01');
INSERT INTO users(name,last_name,birthday) VALUES ('Cris','Tucker','2000-05-04');
INSERT INTO users(name,last_name,birthday) VALUES ('Antony','Ront','1999-01-09');
INSERT INTO users(name,last_name,birthday) VALUES ('Jessy','Pinkman','1991-08-29');
INSERT INTO users(name,last_name,birthday) VALUES ('Mike','Lewandowski','1996-03-15');
INSERT INTO users(name,last_name,birthday) VALUES ('Angel','Noot','2005-02-18');
INSERT INTO users(name,last_name,birthday) VALUES ('Antony','Hopkins','1989-09-13');
INSERT INTO users(name,last_name,birthday) VALUES ('Keanu','Reevs','2007-04-20');

SELECT * FROM users ;
SELECT name,
	   last_name,
	   DATE_FORMAT(birthday, '%d %M %Y') AS birthday
	   WHERE MONTHNAME() 
	   FROM users;
/*
?? ??????? users ?????????? ??????? ?????????????, ?????????? ? ??????? ? ???.
?????? ?????? ? ???? ?????? ?????????? ???????? ('may', 'august').
 */
SELECT * FROM users WHERE MONTHNAME(birthday) IN ('may', 'august');


/*
5)?? ??????? catalogs ??????????? ?????? ??? ?????? ???????.
SELECT * FROM catalogs WHERE id IN (5, 1, 2);
???????????? ?????? ? ???????, ???????? ? ?????? IN
 */
CREATE TABLE catalogs (
  id SERIAL PRIMARY KEY,
  name VARCHAR(255) COMMENT '???????? ???????',
  UNIQUE unique_name(name(10))
) COMMENT = '??????? ????????-????????';

INSERT INTO catalogs VALUES
  (NULL, '??????????'),
  (NULL, '??????????? ?????'),
  (NULL, '??????????'),
  (NULL, '??????? ?????'),
  (NULL, '??????????? ??????');
SELECT * FROM catalogs WHERE id IN (5, 1, 2) ORDER BY FIELD(id, 5, 1, 2); 

/*
???????????? ??????? ???? “????????? ??????”
1)??????????? ??????? ??????? ????????????? ? ??????? users
 */
SELECT SUM(FLOOR((TO_DAYS(NOW()) - TO_DAYS(birthday))/365.25))/COUNT(*) AS age FROM users;
SELECT AVG(FLOOR((TO_DAYS(NOW()) - TO_DAYS(birthday))/365.25)) AS age FROM users;
SELECT AVG(FLOOR(DATEDIFF(NOW(), birthday)/365.25)) FROM users;
/*
2)??????????? ?????????? ???? ????????, ??????? ?????????? ?? ?????? ?? ???? ??????.
??????? ??????, ??? ?????????? ??? ?????? ???????? ????, ? ?? ???? ????????.
 */  

/* ????? ????????????? ??? ????? ???? */
SELECT DAYNAME(
			   DATE_ADD(birthday, INTERVAL (YEAR(NOW())-YEAR(birthday)) YEAR)
			   )
	   AS this_year_birthday,
	   COUNT(*) AS COUNT_OF_DAYS
       FROM users
       GROUP BY this_year_birthday;    
/*SELECT DAYNAME(birthday) FROM users;/*
/* ????? ????????????? ??? ???? ???????? */
SELECT DAYNAME(birthday) AS this_year_birthday,
	   COUNT(*) AS COUNT_OF_DAYS
       FROM users
       GROUP BY this_year_birthday;

/* 3)??????????? ???????????? ????? ? ??????? ??????? */    
DROP TABLE num_tbl;

CREATE TEMPORARY TABLE num_tbl (
value INT NOT NULL);
INSERT INTO num_tbl VALUES(1),(2),(3),(4),(5);
SELECT EXP(SUM(LOG(value))) FROM num_tbl;